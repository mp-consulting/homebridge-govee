<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Govee Plugin Settings</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container py-4">
    <h3 class="mb-4">Govee Plugin</h3>

    <ul class="nav nav-tabs" id="mainTabs" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="devices-tab" data-bs-toggle="tab" data-bs-target="#devices" type="button" role="tab">Devices</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="settings-tab" data-bs-toggle="tab" data-bs-target="#settings" type="button" role="tab">Settings</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="connection-tab" data-bs-toggle="tab" data-bs-target="#connection" type="button" role="tab">Connection</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="tools-tab" data-bs-toggle="tab" data-bs-target="#tools" type="button" role="tab">Tools</button>
      </li>
    </ul>

    <div class="tab-content">
      <!-- Settings Tab -->
      <div class="tab-pane fade" id="settings" role="tabpanel">
        <div class="card">
          <div class="card-header">
            <h5 class="mb-0">Account Settings</h5>
          </div>
          <div class="card-body">
            <div class="mb-3">
              <label for="username" class="form-label">
                Govee Account Email
                <span class="info-icon" data-bs-toggle="tooltip" data-bs-placement="top" title="The email address you use to log in to the Govee app. Required for cloud control and device discovery.">&#9432;</span>
              </label>
              <input type="email" class="form-control" id="username" placeholder="your-email@example.com">
            </div>
            <div class="mb-3">
              <label for="password" class="form-label">
                Govee Account Password
                <span class="info-icon" data-bs-toggle="tooltip" data-bs-placement="top" title="Your Govee account password. This is stored locally and used only to authenticate with Govee servers.">&#9432;</span>
              </label>
              <div class="input-group">
                <input type="password" class="form-control" id="password">
                <button class="btn btn-outline-secondary" type="button" id="togglePassword">Show</button>
              </div>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h5 class="mb-0">General Settings</h5>
          </div>
          <div class="card-body">
            <div class="form-check form-switch">
              <input class="form-check-input" type="checkbox" id="ignoreMatter">
              <label class="form-check-label" for="ignoreMatter">
                Ignore Matter Devices
                <span class="info-icon" data-bs-toggle="tooltip" data-bs-placement="top" title="Skip devices that support Matter protocol. Enable this if you're using Matter to connect those devices directly to HomeKit.">&#9432;</span>
              </label>
            </div>
            <div class="form-check form-switch">
              <input class="form-check-input" type="checkbox" id="disableDeviceLogging">
              <label class="form-check-label" for="disableDeviceLogging">
                Disable Device Logging
                <span class="info-icon" data-bs-toggle="tooltip" data-bs-placement="top" title="Stop logging device state changes to reduce log clutter. Errors will still be logged.">&#9432;</span>
              </label>
            </div>
            <div class="form-check form-switch">
              <input class="form-check-input" type="checkbox" id="colourSafeMode">
              <label class="form-check-label" for="colourSafeMode">
                Colour Safe Mode
                <span class="info-icon" data-bs-toggle="tooltip" data-bs-placement="top" title="Use a slower but more reliable method for setting colours. Enable this if you experience colour issues with your lights.">&#9432;</span>
              </label>
            </div>
          </div>
        </div>
      </div>

      <!-- Connection Tab -->
      <div class="tab-pane fade" id="connection" role="tabpanel">
        <div class="card">
          <div class="card-header">
            <h5 class="mb-0">AWS IoT Connection</h5>
          </div>
          <div class="card-body">
            <div class="form-check form-switch mb-3">
              <input class="form-check-input" type="checkbox" id="awsDisable">
              <label class="form-check-label" for="awsDisable">
                Disable AWS IoT Connection
                <span class="info-icon" data-bs-toggle="tooltip" data-bs-placement="top" title="Disable real-time cloud control via AWS IoT. The plugin will fall back to HTTP polling only. Not recommended unless you have connection issues.">&#9432;</span>
              </label>
            </div>
            <div class="mb-3">
              <label for="httpRefreshTime" class="form-label">
                HTTP Refresh Time (seconds)
                <span class="info-icon" data-bs-toggle="tooltip" data-bs-placement="top" title="How often to poll the Govee API for device state updates. Lower values mean faster updates but more API calls. Minimum 60 seconds.">&#9432;</span>
              </label>
              <input type="number" class="form-control" id="httpRefreshTime" min="60" value="60">
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h5 class="mb-0">LAN Connection</h5>
          </div>
          <div class="card-body">
            <div class="form-check form-switch mb-3">
              <input class="form-check-input" type="checkbox" id="lanDisable">
              <label class="form-check-label" for="lanDisable">
                Disable LAN Control
                <span class="info-icon" data-bs-toggle="tooltip" data-bs-placement="top" title="Disable local network control. LAN control is faster and works without internet. Only disable if you experience network issues.">&#9432;</span>
              </label>
            </div>
            <div class="mb-3">
              <label for="lanRefreshTime" class="form-label">
                LAN Refresh Time (seconds)
                <span class="info-icon" data-bs-toggle="tooltip" data-bs-placement="top" title="How often to poll LAN devices for state updates. Lower values mean faster updates. Minimum 15 seconds.">&#9432;</span>
              </label>
              <input type="number" class="form-control" id="lanRefreshTime" min="15" value="30">
            </div>
            <div class="mb-3">
              <label for="lanScanInterval" class="form-label">
                LAN Scan Interval (seconds)
                <span class="info-icon" data-bs-toggle="tooltip" data-bs-placement="top" title="How often to scan the network for new LAN-capable devices. Minimum 30 seconds.">&#9432;</span>
              </label>
              <input type="number" class="form-control" id="lanScanInterval" min="30" value="60">
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h5 class="mb-0">Bluetooth (BLE) Connection</h5>
          </div>
          <div class="card-body">
            <div class="form-check form-switch mb-3">
              <input class="form-check-input" type="checkbox" id="bleDisable">
              <label class="form-check-label" for="bleDisable">
                Disable Bluetooth Control
                <span class="info-icon" data-bs-toggle="tooltip" data-bs-placement="top" title="Disable Bluetooth Low Energy control. BLE works for nearby devices without network. Requires compatible hardware (works best on Raspberry Pi).">&#9432;</span>
              </label>
            </div>
            <div class="mb-3">
              <label for="bleRefreshTime" class="form-label">
                BLE Refresh Time (seconds)
                <span class="info-icon" data-bs-toggle="tooltip" data-bs-placement="top" title="How often to scan for BLE sensor readings (temperature, humidity, etc.). Minimum 15 seconds.">&#9432;</span>
              </label>
              <input type="number" class="form-control" id="bleRefreshTime" min="15" value="30">
            </div>
            <div class="mb-3">
              <label for="bleControlInterval" class="form-label">
                BLE Control Interval (ms)
                <span class="info-icon" data-bs-toggle="tooltip" data-bs-placement="top" title="Minimum time between BLE commands to prevent overwhelming devices. Increase if you experience connection drops. Minimum 500ms.">&#9432;</span>
              </label>
              <input type="number" class="form-control" id="bleControlInterval" min="500" value="500">
            </div>
          </div>
        </div>
      </div>

      <!-- Devices Tab -->
      <div class="tab-pane fade show active" id="devices" role="tabpanel">
        <div class="alert alert-info">
          <strong>Tip:</strong> Configure device-specific settings here. Use "Discover Devices" in the Tools tab to find your device IDs.
        </div>

        <div class="accordion" id="deviceAccordion">
          <!-- Light Devices -->
          <div class="accordion-item">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#lightDevicesCollapse">
                <span class="me-2">üí°</span> Light Devices <span class="badge bg-secondary ms-2" id="lightDevicesCount">0</span>
              </button>
            </h2>
            <div id="lightDevicesCollapse" class="accordion-collapse collapse" data-bs-parent="#deviceAccordion">
              <div class="accordion-body">
                <button class="btn btn-outline-primary btn-sm btn-add-device" onclick="addDevice('lightDevices')">+ Add Light Device</button>
                <div id="lightDevicesList"></div>
              </div>
            </div>
          </div>

          <!-- Switch Devices -->
          <div class="accordion-item">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#switchDevicesCollapse">
                <span class="me-2">üîå</span> Switch/Outlet Devices <span class="badge bg-secondary ms-2" id="switchDevicesCount">0</span>
              </button>
            </h2>
            <div id="switchDevicesCollapse" class="accordion-collapse collapse" data-bs-parent="#deviceAccordion">
              <div class="accordion-body">
                <button class="btn btn-outline-primary btn-sm btn-add-device" onclick="addDevice('switchDevices')">+ Add Switch Device</button>
                <div id="switchDevicesList"></div>
              </div>
            </div>
          </div>

          <!-- Thermo Devices -->
          <div class="accordion-item">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#thermoDevicesCollapse">
                <span class="me-2">üå°Ô∏è</span> Temperature/Humidity Sensors <span class="badge bg-secondary ms-2" id="thermoDevicesCount">0</span>
              </button>
            </h2>
            <div id="thermoDevicesCollapse" class="accordion-collapse collapse" data-bs-parent="#deviceAccordion">
              <div class="accordion-body">
                <button class="btn btn-outline-primary btn-sm btn-add-device" onclick="addDevice('thermoDevices')">+ Add Sensor</button>
                <div id="thermoDevicesList"></div>
              </div>
            </div>
          </div>

          <!-- Leak Devices -->
          <div class="accordion-item">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#leakDevicesCollapse">
                <span class="me-2">üíß</span> Leak Sensors <span class="badge bg-secondary ms-2" id="leakDevicesCount">0</span>
              </button>
            </h2>
            <div id="leakDevicesCollapse" class="accordion-collapse collapse" data-bs-parent="#deviceAccordion">
              <div class="accordion-body">
                <button class="btn btn-outline-primary btn-sm btn-add-device" onclick="addDevice('leakDevices')">+ Add Leak Sensor</button>
                <div id="leakDevicesList"></div>
              </div>
            </div>
          </div>

          <!-- Fan Devices -->
          <div class="accordion-item">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#fanDevicesCollapse">
                <span class="me-2">üåÄ</span> Fan Devices <span class="badge bg-secondary ms-2" id="fanDevicesCount">0</span>
              </button>
            </h2>
            <div id="fanDevicesCollapse" class="accordion-collapse collapse" data-bs-parent="#deviceAccordion">
              <div class="accordion-body">
                <button class="btn btn-outline-primary btn-sm btn-add-device" onclick="addDevice('fanDevices')">+ Add Fan</button>
                <div id="fanDevicesList"></div>
              </div>
            </div>
          </div>

          <!-- Heater Devices -->
          <div class="accordion-item">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#heaterDevicesCollapse">
                <span class="me-2">üî•</span> Heater Devices <span class="badge bg-secondary ms-2" id="heaterDevicesCount">0</span>
              </button>
            </h2>
            <div id="heaterDevicesCollapse" class="accordion-collapse collapse" data-bs-parent="#deviceAccordion">
              <div class="accordion-body">
                <button class="btn btn-outline-primary btn-sm btn-add-device" onclick="addDevice('heaterDevices')">+ Add Heater</button>
                <div id="heaterDevicesList"></div>
              </div>
            </div>
          </div>

          <!-- Humidifier Devices -->
          <div class="accordion-item">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#humidifierDevicesCollapse">
                <span class="me-2">üí®</span> Humidifier Devices <span class="badge bg-secondary ms-2" id="humidifierDevicesCount">0</span>
              </button>
            </h2>
            <div id="humidifierDevicesCollapse" class="accordion-collapse collapse" data-bs-parent="#deviceAccordion">
              <div class="accordion-body">
                <button class="btn btn-outline-primary btn-sm btn-add-device" onclick="addDevice('humidifierDevices')">+ Add Humidifier</button>
                <div id="humidifierDevicesList"></div>
              </div>
            </div>
          </div>

          <!-- Purifier Devices -->
          <div class="accordion-item">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#purifierDevicesCollapse">
                <span class="me-2">üå¨Ô∏è</span> Air Purifier Devices <span class="badge bg-secondary ms-2" id="purifierDevicesCount">0</span>
              </button>
            </h2>
            <div id="purifierDevicesCollapse" class="accordion-collapse collapse" data-bs-parent="#deviceAccordion">
              <div class="accordion-body">
                <button class="btn btn-outline-primary btn-sm btn-add-device" onclick="addDevice('purifierDevices')">+ Add Purifier</button>
                <div id="purifierDevicesList"></div>
              </div>
            </div>
          </div>

          <!-- Dehumidifier Devices -->
          <div class="accordion-item">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#dehumidifierDevicesCollapse">
                <span class="me-2">üí¶</span> Dehumidifier Devices <span class="badge bg-secondary ms-2" id="dehumidifierDevicesCount">0</span>
              </button>
            </h2>
            <div id="dehumidifierDevicesCollapse" class="accordion-collapse collapse" data-bs-parent="#deviceAccordion">
              <div class="accordion-body">
                <button class="btn btn-outline-primary btn-sm btn-add-device" onclick="addDevice('dehumidifierDevices')">+ Add Dehumidifier</button>
                <div id="dehumidifierDevicesList"></div>
              </div>
            </div>
          </div>

          <!-- Diffuser Devices -->
          <div class="accordion-item">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#diffuserDevicesCollapse">
                <span class="me-2">üå∏</span> Diffuser Devices <span class="badge bg-secondary ms-2" id="diffuserDevicesCount">0</span>
              </button>
            </h2>
            <div id="diffuserDevicesCollapse" class="accordion-collapse collapse" data-bs-parent="#deviceAccordion">
              <div class="accordion-body">
                <button class="btn btn-outline-primary btn-sm btn-add-device" onclick="addDevice('diffuserDevices')">+ Add Diffuser</button>
                <div id="diffuserDevicesList"></div>
              </div>
            </div>
          </div>

          <!-- Kettle Devices -->
          <div class="accordion-item">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#kettleDevicesCollapse">
                <span class="me-2">‚òï</span> Kettle Devices <span class="badge bg-secondary ms-2" id="kettleDevicesCount">0</span>
              </button>
            </h2>
            <div id="kettleDevicesCollapse" class="accordion-collapse collapse" data-bs-parent="#deviceAccordion">
              <div class="accordion-body">
                <button class="btn btn-outline-primary btn-sm btn-add-device" onclick="addDevice('kettleDevices')">+ Add Kettle</button>
                <div id="kettleDevicesList"></div>
              </div>
            </div>
          </div>

          <!-- Ice Maker Devices -->
          <div class="accordion-item">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#iceMakerDevicesCollapse">
                <span class="me-2">üßä</span> Ice Maker Devices <span class="badge bg-secondary ms-2" id="iceMakerDevicesCount">0</span>
              </button>
            </h2>
            <div id="iceMakerDevicesCollapse" class="accordion-collapse collapse" data-bs-parent="#deviceAccordion">
              <div class="accordion-body">
                <button class="btn btn-outline-primary btn-sm btn-add-device" onclick="addDevice('iceMakerDevices')">+ Add Ice Maker</button>
                <div id="iceMakerDevicesList"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Tools Tab -->
      <div class="tab-pane fade" id="tools" role="tabpanel">
        <div class="card">
          <div class="card-header">
            <h5 class="mb-0">Account Connection Test</h5>
          </div>
          <div class="card-body">
            <p class="text-muted">Test your Govee account credentials to verify they work correctly.</p>
            <button id="testLoginBtn" class="btn btn-primary">
              <span id="testLoginSpinner" class="spinner-border d-none" role="status"></span>
              Test Connection
            </button>
            <div id="loginResult" class="mt-3"></div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h5 class="mb-0">Device Discovery</h5>
          </div>
          <div class="card-body">
            <p class="text-muted">Discover all devices linked to your Govee account. Use the device IDs to configure specific devices in the Devices tab.</p>
            <button id="discoverBtn" class="btn btn-secondary">
              <span id="discoverSpinner" class="spinner-border d-none" role="status"></span>
              Discover Devices
            </button>
            <div id="deviceList" class="device-list mt-3"></div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h5 class="mb-0">Documentation</h5>
          </div>
          <div class="card-body">
            <p>For more information about configuration options, see the <a href="https://github.com/mp-consulting/homebridge-govee#readme" target="_blank">README</a>.</p>
            <ul>
              <li><strong>AWS IoT:</strong> Real-time control via Govee cloud (requires credentials)</li>
              <li><strong>LAN:</strong> Local network control (faster, works without internet)</li>
              <li><strong>BLE:</strong> Bluetooth control for nearby devices (requires compatible hardware)</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- Save Button -->
    <div class="d-grid gap-2 mt-3">
      <button id="saveBtn" class="btn btn-success btn-lg">
        <span id="saveSpinner" class="spinner-border d-none" role="status"></span>
        Save Configuration
      </button>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="models.js"></script>
  <script src="script.js"></script>
</body>
</html>
